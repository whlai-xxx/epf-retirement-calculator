<!-- START OF FILE ai_studio_code (19).html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malaysia EPF Retirement Calculator - Montserrat Design</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Font: Montserrat -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 40px 20px;
            background-color: #F3F4F6; /* Cool light grey */
            color: #1F2937;
            line-height: 1.5;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #FFFFFF;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            position: relative;
        }

        /* --- HEADER SECTION --- */
        .header-background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 160px; /* Fixed height */
            /* UPDATED IMAGE: Plant/Seedling */
            background-image: url('https://images.unsplash.com/photo-1546768292-fb12f6c92568?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            opacity: 0.15;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            z-index: 0;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
            /* Flexbox for centering */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 160px; 
            
            /* Negative margins pull the text box up to ignore container padding */
            margin-top: -40px;
            margin-left: -40px;
            margin-right: -40px;
            margin-bottom: 30px; 
            padding-bottom: 0; 

            border-bottom: 1px solid #E5E7EB;
            text-align: center;
            box-sizing: border-box; 
            gap: 4px; 
        }

        h1 {
            color: #111827;
            font-weight: 700;
            letter-spacing: -0.025em;
            margin: 0; 
            font-size: 28px;
            text-transform: uppercase;
            line-height: 1.2;
        }
        .creator-info {
            color: #6B7280;
            font-size: 0.85em;
            font-weight: 500;
            margin: 0; 
            line-height: 1.4;
        }

        /* Form Layout */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between; 
            margin-bottom: 0; 
        }
        .input-group {
            flex: 0 0 calc(50% - 15px);
            display: flex;
            flex-direction: row; 
            align-items: center; 
            margin-bottom: 20px;
        }
        .input-group label {
            flex: 1;
            margin-right: 15px;
            margin-bottom: 0;
            font-weight: 600;
            font-size: 0.8rem;
            color: #4B5563;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            text-align: left;
        }
        .input-group input {
            flex: 0 0 140px; 
            max-width: 140px;
            padding: 10px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            background-color: #F9FAFB;
            color: #111827;
            text-align: center;
        }
        .input-group input:focus {
            outline: none;
            border-color: #F97316; 
            background-color: #FFFFFF;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }

        /* Tooltip Styles */
        .icon-wrapper.tooltip {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            cursor: help;
            flex-shrink: 0; 
        }
        .icon-wrapper.tooltip .tooltiptext {
            visibility: hidden;
            width: 240px;
            background-color: #1F2937;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 10;
            bottom: 140%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 0.75rem;
            font-weight: 500;
            line-height: 1.4;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            text-transform: none;
        }
        .icon-wrapper.tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -6px;
            border-width: 6px;
            border-style: solid;
            border-color: #1F2937 transparent transparent transparent;
        }
        .icon-wrapper.tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .info-icon { font-size: 1rem; line-height: 1; }

        /* Button */
        button#calculateButton {
            display: block;
            width: 100%;
            max-width: 350px;
            margin: 40px auto 10px auto;
            padding: 16px;
            background-color: #F97316; 
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 4px 6px -1px rgba(249, 115, 22, 0.3);
        }
        button#calculateButton:hover {
            background-color: #EA580C; 
            transform: translateY(-1px);
        }
        button#calculateButton:active {
            transform: translateY(1px);
        }

        /* Summary & Chart Layout */
        .summary-chart-container {
            display: flex;
            gap: 30px;
            margin-top: 50px;
            align-items: stretch;
        }
        
        #summaryBox {
            flex: 0 0 280px;
            background: #EFF6FF; 
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #DBEAFE;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        /* Quick Insights Title */
        #summaryBox h3 {
            color: #1E40AF;
            font-size: 2.1rem; 
            margin-top: 0;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 20px;
        }
        
        #summaryBox p {
            color: #374151;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        /* Depletion & Longevity Text */
        .depletion-age-text {
            font-size: 4.5rem; 
            color: #DC2626;
            font-weight: 700;
            line-height: 1;
            vertical-align: middle;
            display: block; 
            margin-top: 5px;
        }
        
        .longevity-text {
            font-size: 4.5rem; 
            color: #059669; 
            font-weight: 700; 
            line-height: 1;
            display: block;
            margin-top: 5px;
        }

        .life-expectancy-group {
            margin-top: auto; 
            padding-top: 20px;
            border-top: 1px solid #DBEAFE;
        }
        .life-expectancy-group p {
            font-size: 0.85rem;
            margin: 5px 0;
            font-weight: 600;
            color: #6B7280;
        }
        .life-expectancy-group span {
            font-size: 1.1rem;
            font-weight: 700;
            color: #111827;
        }
        #maleLifeExpectancyValue { color: #2563EB; }
        #femaleLifeExpectancyValue { color: #DB2777; }

        /* Charts Area */
        #chart-section {
            flex-grow: 1;
            padding-top: 0;
        }
        .chart-toggle-group {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .chart-toggle-group button {
            flex: 1;
            max-width: 180px;
            padding: 10px 16px;
            border: 1px solid #D1D5DB;
            background-color: #FFFFFF;
            color: #4B5563;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s ease;
            margin: 0;
            font-family: 'Montserrat', sans-serif;
        }
        .chart-toggle-group button:first-child {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
            border-right: none;
        }
        .chart-toggle-group button:last-child {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
            border-left: 1px solid #D1D5DB;
        }
        
        .chart-toggle-group button:hover:not(.active) {
            background-color: #F3F4F6;
        }
        #showBalanceChart.active {
            background-color: #2563EB; 
            color: white;
            border-color: #2563EB;
            z-index: 1;
        }
        #showDividendChart.active {
            background-color: #10B981; 
            color: white;
            border-color: #10B981;
            z-index: 1;
        }

        .chart-container-wrapper {
            background: white;
            border-radius: 8px;
            padding: 10px; 
            height: 400px;
        }
        #chart-section h2 { display: none; }

        /* Results Table */
        #results { margin-top: 50px; }
        #results h2 {
            color: #111827;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 25px;
        }
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            text-align: center;
        }
        table thead tr {
            background-color: #F9FAFB;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 5;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        table th {
            padding: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.75rem;
            border: none;
            border-bottom: 2px solid #E5E7EB;
        }
        table td {
            padding: 14px 16px;
            border: none;
            border-bottom: 1px solid #E5E7EB;
            color: #4B5563; /* This is the standard Div. Earned color */
        }
        table tbody tr:last-child td { border-bottom: none; }
        table tbody tr:nth-of-type(even) { background-color: #FAFAFA; }
        table tbody tr:hover { background-color: #F3F4F6; }
        
        .positive-saving { color: #059669; font-weight: 600; } 
        .negative-saving { color: #DC2626; font-weight: 600; } 
        
        .zero-saving { color: #4B5563; font-weight: 400; background-color: transparent; }
        
        .withdrawal-positive { color: #DC2626; font-weight: 600; } 
        
        @media (max-width: 768px) {
            .container { padding: 20px; }
            .input-group { flex: 0 0 100%; }
            .summary-chart-container { flex-direction: column; }
            #summaryBox { width: auto; margin-right: 0; margin-bottom: 30px; }
            .header-background-image { height: 140px; }
            
            /* Adjust negative margins for mobile padding */
            .header-content { 
                height: 140px; 
                margin-top: -20px;
                margin-left: -20px;
                margin-right: -20px;
                margin-bottom: 20px; 
            } 
            h1 { font-size: 22px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-background-image"></div>
        <div class="header-content">
            <h1>Malaysia EPF Retirement Calculator</h1>
            <p class="creator-info">
                Created by WH Lai, 22-11-2025<br>
                The developer assumes no responsibility for any consequences of its use.
            </p>
        </div>

        <div class="form-row" style="margin-top: 0;"> 
            <div class="input-group">
                <label for="currentSaving">
                    <span class="icon-wrapper tooltip">
                        <span class="info-icon" aria-label="Info">üí∞</span>
                        <span class="tooltiptext">Enter the total amount currently accumulated in your EPF account.</span>
                    </span>
                    Current EPF Balance (RM)
                </label>
                <!-- Whole Number Only: step="1" and onkeypress block decimals -->
                <input type="number" id="currentSaving" value="50000" min="0" step="1" placeholder="e.g. 50000" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            </div>
            <div class="input-group">
                <label for="age">
                    <span class="icon-wrapper tooltip">
                        <span class="info-icon" aria-label="Info">üéÇ</span>
                        <span class="tooltiptext">Your age in years as of today.</span>
                    </span>
                    Current Age (Years)
                </label>
                <!-- Whole Number Only -->
                <input type="number" id="age" value="30" min="18" max="99" step="1" placeholder="e.g. 30" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            </div>
        </div>

        <div class="form-row">
            <div class="input-group">
                <label for="annualSaving">
                    <span class="icon-wrapper tooltip">
                        <span class="info-icon" aria-label="Info">üíµ</span>
                        <span class="tooltiptext">Total estimated annual EPF contribution (Employee + Employer).</span>
                    </span>
                    Annual Contribution (RM)
                </label>
                <!-- Whole Number Only -->
                <input type="number" id="annualSaving" value="10000" min="0" step="1" placeholder="e.g. 10000" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            </div>
            <div class="input-group">
                <label for="projectedContributionIncrement">
                    <span class="icon-wrapper tooltip">
                        <span class="info-icon" aria-label="Info">‚ÜóÔ∏è</span>
                        <span class="tooltiptext">Expected yearly increase in EPF contribution (%).</span>
                    </span>
                    Contribution Growth Rate (%)
                </label>
                <!-- Decimals Allowed -->
                <input type="number" id="projectedContributionIncrement" value="3" min="0" step="0.1" placeholder="e.g. 3">
            </div>
        </div>
        
        <div class="form-row">
            <div class="input-group">
                <label for="contributionAgeLimit">
                    <span class="icon-wrapper tooltip">
                        <span class="info-icon" aria-label="Info">üõë</span>
                        <span class="tooltiptext">Age at which you will stop contributing to EPF.</span>
                    </span>
                    Age to Cease Contributions
                </label>
                <!-- Whole Number Only -->
                <input type="number" id="contributionAgeLimit" value="55" min="18" max="99" step="1" placeholder="e.g. 55" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            </div>
            <div class="input-group">
                <label for="interestRate">
                    <span class="icon-wrapper tooltip">
                        <span class="info-icon" aria-label="Info">üìä</span>
                        <span class="tooltiptext">Expected annual EPF dividend rate (typically 4-6%).</span>
                    </span>
                    Annual Dividend Rate (%)
                </label>
                <!-- Decimals Allowed -->
                <input type="number" id="interestRate" value="5" min="0" step="0.1" placeholder="e.g. 5">
            </div>
        </div>

        <div class="form-row">
            <div class="input-group">
                <label for="annualWithdrawal">
                    <span class="icon-wrapper tooltip">
                        <span class="info-icon" aria-label="Info">üí∏</span>
                        <span class="tooltiptext">Initial yearly amount to withdraw from EPF for retirement expenses.</span>
                    </span>
                    Annual Withdrawal (RM)
                </label>
                <!-- Whole Number Only -->
                <input type="number" id="annualWithdrawal" value="5000" min="0" step="1" placeholder="e.g. 5000" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            </div>
            <div class="input-group">
                <label for="initialWithdrawalAge">
                    <span class="icon-wrapper tooltip">
                        <span class="info-icon" aria-label="Info">üëµ</span>
                        <span class="tooltiptext">Age to start making annual EPF withdrawals (Minimum 55).</span>
                    </span>
                    Withdrawal Start Age
                </label>
                <!-- Whole Number Only -->
                <input type="number" id="initialWithdrawalAge" value="55" min="55" max="99" step="1" placeholder="e.g. 55" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            </div>
        </div>

        <div class="form-row">
            <div class="input-group">
                <label for="inflationRate">
                    <span class="icon-wrapper tooltip">
                        <span class="info-icon" aria-label="Info">üî•</span>
                        <span class="tooltiptext">Expected annual inflation rate to adjust withdrawal amount.</span>
                    </span>
                    Inflation Rate (%)
                </label>
                <!-- Decimals Allowed -->
                <input type="number" id="inflationRate" value="2" min="0" step="0.1" placeholder="e.g. 2">
            </div>
            <div class="input-group" style="visibility: hidden;"></div>
        </div>

        <button id="calculateButton" onclick="calculateEPF()">Calculate Projection</button>

        <div class="summary-chart-container">
            <!-- Summary Box -->
            <div id="summaryBox">
                <h3>Quick Insights</h3>
                <p id="depletionMessage">
                    <!-- Message inserted by JS -->
                </p>
                <div class="life-expectancy-group">
                    <p>Avg Life Expectancy</p>
                    <p>Male: <span id="maleLifeExpectancyValue">72.9</span> | Female: <span id="femaleLifeExpectancyValue">77.6</span></p>
                </div>
            </div>

            <div id="chart-section">
                <div class="chart-toggle-group">
                    <button id="showBalanceChart" class="active" onclick="switchChart('balance')">Balance History</button>
                    <button id="showDividendChart" onclick="switchChart('dividend')">Dividend History</button>
                </div>
                
                <div id="epfBalanceChartWrapper" class="chart-container-wrapper">
                    <h2>Year-End EPF Balance Projection</h2>
                    <canvas id="epfBalanceChart"></canvas>
                </div>

                <div id="epfDividendChartWrapper" class="chart-container-wrapper" style="display:none;">
                    <h2>Yearly EPF Dividend Earning Projection</h2>
                    <canvas id="epfDividendChart"></canvas>
                </div>
            </div>
        </div>

        <div id="results">
            <h2>Retirement Projection Table</h2>
            <div class="table-container">
                <table id="epfTable">
                    <thead>
                        <tr>
                            <th>Age</th>
                            <th>Starting Bal. (RM)</th>
                            <th>Contrib. (RM)</th>
                            <th>Div. Rate</th>
                            <th>Div. Earned (RM)</th>
                            <th>Withdrawal (RM)</th>
                            <th>End Bal. (RM)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Results inserted by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let epfBalanceChart;
        let epfDividendChart;
        let currentChart = 'balance'; 

        // Fields that must be integers
        const integerFields = [
            'currentSaving', 
            'age', 
            'annualSaving', 
            'contributionAgeLimit', 
            'annualWithdrawal', 
            'initialWithdrawalAge'
        ];

        function validateInput(inputElement) {
            let val = inputElement.value;
            let isValid = true;

            // Check if empty or not a number
            if (val === '' || isNaN(parseFloat(val))) {
                isValid = false;
            } 
            // Check for decimals in restricted fields
            else if (integerFields.includes(inputElement.id) && (val.includes('.') || val % 1 !== 0)) {
                isValid = false;
            }

            if (!isValid) {
                inputElement.style.backgroundColor = '#FEF2F2';
                inputElement.style.borderColor = '#DC2626';
                return false;
            } else {
                inputElement.style.backgroundColor = '#F9FAFB';
                inputElement.style.borderColor = '#D1D5DB';
                return true;
            }
        }

        function calculateEPF() {
            const inputIds = [
                'currentSaving', 'age', 'annualSaving', 'projectedContributionIncrement',
                'contributionAgeLimit', 'interestRate', 'inflationRate', 'annualWithdrawal',
                'initialWithdrawalAge'
            ];
            let allInputsValid = true;

            inputIds.forEach(id => {
                const inputElement = document.getElementById(id);
                if (!validateInput(inputElement)) {
                    allInputsValid = false;
                }
            });

            if (!allInputsValid) {
                alert('Please fill in all fields correctly. Note that some fields (like Age and amounts) do not accept decimal values.');
                return;
            }

            let currentAge = parseInt(document.getElementById('age').value);
            let contributionAgeLimit = parseInt(document.getElementById('contributionAgeLimit').value);
            let initialWithdrawalAge = parseInt(document.getElementById('initialWithdrawalAge').value);
            
            if (contributionAgeLimit < currentAge) { alert('Age to Cease Contributions must be >= Current Age.'); return; }
            if (initialWithdrawalAge < 55) { alert('Withdrawal Age must be >= 55.'); return; }
            if (initialWithdrawalAge < currentAge) { alert('Withdrawal Age cannot be less than Current Age.'); return; }

            let initialAge = currentAge; 
            // Use parseFloat for all amounts initially, but restricted inputs are effectively integers
            let currentAnnualSaving = parseFloat(document.getElementById('annualSaving').value);
            
            let projectedContributionIncrementRate = parseFloat(document.getElementById('projectedContributionIncrement').value) / 100;
            let interestRate = parseFloat(document.getElementById('interestRate').value) / 100;
            let inflationRate = parseFloat(document.getElementById('inflationRate').value) / 100;
            let initialAnnualWithdrawal = parseFloat(document.getElementById('annualWithdrawal').value);

            const tableBody = document.querySelector('#epfTable tbody');
            tableBody.innerHTML = '';

            let projectedSaving = parseFloat(document.getElementById('currentSaving').value);

            const ages = [];
            const savings = []; 
            const dividendEarnings = [];

            let annualWithdrawalAdjustedForInflation = initialAnnualWithdrawal; 
            let withdrawalStarted = false;
            let previousYearEndSaving = projectedSaving; 
            let depletionAge = -1;

            for (let i = initialAge; i <= 100; i++) {
                let yearStartSaving = projectedSaving;
                let annualContributionForThisYear = 0;

                if (i < contributionAgeLimit) {
                    annualContributionForThisYear = currentAnnualSaving;
                    currentAnnualSaving *= (1 + projectedContributionIncrementRate); 
                }

                let savingBeforeInterest = yearStartSaving + annualContributionForThisYear;
                let interestEarned = savingBeforeInterest * interestRate;
                let savingAfterInterest = savingBeforeInterest + interestEarned;

                let actualWithdrawalThisYear = 0;

                if (i >= initialWithdrawalAge) {
                    if (!withdrawalStarted) {
                        actualWithdrawalThisYear = initialAnnualWithdrawal;
                        annualWithdrawalAdjustedForInflation = initialAnnualWithdrawal; 
                        withdrawalStarted = true;
                    } else {
                        annualWithdrawalAdjustedForInflation = annualWithdrawalAdjustedForInflation * (1 + inflationRate);
                        actualWithdrawalThisYear = annualWithdrawalAdjustedForInflation;
                    }
                    if (savingAfterInterest < actualWithdrawalThisYear) {
                        actualWithdrawalThisYear = savingAfterInterest;
                    }
                }
                
                let yearEndEPFSaving = savingAfterInterest - actualWithdrawalThisYear;
                
                // Table Row
                const row = tableBody.insertRow();
                row.insertCell().textContent = i;
                row.insertCell().textContent = yearStartSaving.toLocaleString('en-MY', {minimumFractionDigits:0, maximumFractionDigits:0});
                row.insertCell().textContent = annualContributionForThisYear.toLocaleString('en-MY', {minimumFractionDigits:0, maximumFractionDigits:0});
                row.insertCell().textContent = (interestRate * 100).toFixed(1) + '%';
                row.insertCell().textContent = interestEarned.toLocaleString('en-MY', {minimumFractionDigits:0, maximumFractionDigits:0});
                
                const withdrawalCell = row.insertCell();
                withdrawalCell.textContent = actualWithdrawalThisYear.toLocaleString('en-MY', {minimumFractionDigits:0, maximumFractionDigits:0});
                if (actualWithdrawalThisYear > 0) withdrawalCell.classList.add('withdrawal-positive');

                const projectedSavingCell = row.insertCell();
                projectedSavingCell.textContent = yearEndEPFSaving.toLocaleString('en-MY', {minimumFractionDigits:0, maximumFractionDigits:0});

                if (yearEndEPFSaving <= 0) { 
                    if (depletionAge === -1) depletionAge = i;
                    projectedSavingCell.classList.add('zero-saving');
                } 
                else if (yearEndEPFSaving >= previousYearEndSaving) {
                    projectedSavingCell.classList.add('positive-saving');
                } 
                else {
                    projectedSavingCell.classList.add('negative-saving');
                }

                ages.push(i);
                savings.push(yearEndEPFSaving); 
                dividendEarnings.push(interestEarned);

                previousYearEndSaving = yearEndEPFSaving; 
                projectedSaving = yearEndEPFSaving;
            }
            
            createEPFBalanceChart(ages, savings); 
            createEPFDividendChart(ages, dividendEarnings); 
            
            const depletionMessageElement = document.getElementById('depletionMessage');
            if (depletionAge !== -1) {
                depletionMessageElement.innerHTML = `Savings fully depleted at age <span class="depletion-age-text">${depletionAge}</span>`;
            } else {
                depletionMessageElement.innerHTML = `Savings projected to last<span class="longevity-text">>100yrs</span>`;
            }

            if (currentChart === 'balance') switchChart('balance');
            else switchChart('dividend');
        }

        function createEPFBalanceChart(ages, savings) {
            const ctx = document.getElementById('epfBalanceChart').getContext('2d');
            if (epfBalanceChart) epfBalanceChart.destroy();

            epfBalanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ages,
                    datasets: [{
                        label: 'Balance (RM)',
                        data: savings, 
                        borderColor: '#2563EB', 
                        backgroundColor: 'rgba(37, 99, 235, 0.1)', 
                        fill: true, 
                        tension: 0.3, 
                        pointRadius: 0,
                        pointHitRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { display: false } }, 
                        y: { beginAtZero: true, grid: { borderDash: [5, 5], color: '#E5E7EB' } }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: '#1F2937',
                            padding: 12,
                            titleFont: { family: 'Montserrat' },
                            bodyFont: { family: 'Montserrat' },
                            callbacks: { label: function(context) { return ' RM ' + new Intl.NumberFormat('en-MY').format(context.raw); } }
                        },
                        legend: { display: false }
                    }
                }
            });
        }

        function createEPFDividendChart(ages, dividendEarnings) {
            const ctx = document.getElementById('epfDividendChart').getContext('2d');
            if (epfDividendChart) epfDividendChart.destroy();

            epfDividendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ages,
                    datasets: [{
                        label: 'Dividend (RM)',
                        data: dividendEarnings,
                        borderColor: '#10B981', 
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true, 
                        tension: 0.3, 
                        pointRadius: 0,
                        pointHitRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { display: false } },
                        y: { beginAtZero: true, grid: { borderDash: [5, 5], color: '#E5E7EB' } }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: '#1F2937',
                            padding: 12,
                            titleFont: { family: 'Montserrat' },
                            bodyFont: { family: 'Montserrat' },
                            callbacks: { label: function(context) { return ' RM ' + new Intl.NumberFormat('en-MY').format(context.raw); } }
                        },
                        legend: { display: false }
                    }
                }
            });
        }

        function switchChart(chartType) {
            const balanceWrapper = document.getElementById('epfBalanceChartWrapper');
            const dividendWrapper = document.getElementById('epfDividendChartWrapper');
            const btnBalance = document.getElementById('showBalanceChart');
            const btnDividend = document.getElementById('showDividendChart');

            if (chartType === 'balance') {
                balanceWrapper.style.display = 'block';
                dividendWrapper.style.display = 'none';
                btnBalance.classList.add('active');
                btnDividend.classList.remove('active');
                currentChart = 'balance';
            } else {
                balanceWrapper.style.display = 'none';
                dividendWrapper.style.display = 'block';
                btnBalance.classList.remove('active');
                btnDividend.classList.add('active');
                currentChart = 'dividend';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            calculateEPF(); 
        });
    </script>
</body>
</html>